<?php

/**
 * ActivityFeedTable
 * 
 * This class has been auto-generated by the Doctrine ORM Framework
 */
class ActivityFeedTable extends Doctrine_Table {

    const TYPE_PEER_INVITED = 0;
    const TYPE_PEER_ACCEPTED = 1;
    const TYPE_EMAIL_RECEIVED = 2;
    const TYPE_EMAIL_SENT = 3;
    const TYPE_ANNOUNCEMENT_POSTED = 4;
    const TYPE_NEWS_ITEM_POSTED = 5;
    const TYPE_DISCUSSION_GROUP_CREATED = 6;
    const TYPE_DISCUSSION_TOPIC_SUBMITTED = 7;
    const TYPE_DISCUSSION_POST_SUBMITTED = 8;
    const TYPE_DISCUSSION_COMMENT_SUBMITTED = 9;
    const TYPE_DISCUSSION_PEER_SUBSCRIBED = 10;
    const TYPE_DISCUSSION_PEER_UNSUBSCRIBED = 11;
    const TYPE_ASSINGMENT_PENDING = 12;
    const TYPE_ASSIGNMENT_SUBMITTED = 13;
    const TYPE_ASSIGNMENT_FILE_SUBMITTED = 14;
    const TYPE_ASSIGNMENT_UPCOMING = 15;
    const TYPE_COURSE_FILE_SUBMITTED = 16;
    const TYPE_COURSE_ENROLLED = 17;
    const TYPE_COURSE_UNREGISTERED = 18;
    const TYPE_EVENT_INVITED = 19;
    const TYPE_EVENT_ACCEPTED = 20;
    const TYPE_EVENT_DECLINED = 21;
    const TYPE_PROFILE_ENROLLED = 22;

    static public $types = array(
        0 => 'Sent peer invitation',
        1 => 'Accepted peer invitation',
        2 => 'Suggested peer',
        3 => 'Sent email',
        4 => 'Posted announcenment',
        5 => 'Posted news',
        6 => 'Posted discussion group',
        7 => 'Posted discussion topic',
        8 => 'Posted discussion post',
        9 => 'Posted discussion comment',
        10 => 'Subscribed discussion peer',
        11 => 'Unsubscribed discussion peer',
        12 => 'Pending assignment',
        13 => 'Submitted assignment',
        14 => 'Submitted assignment file',
        15 => 'Submitted course file',
        16 => 'Upcoming assignment',
        17 => 'Upcoming event',
        18 => 'Received email'
    );

    /**
     * Returns an instance of this class.
     *
     * @return object ActivityFeedTable
     */
    public static function getInstance() {
        return Doctrine_Core::getTable('ActivityFeed');
    }

    public function findByProfileId($profileId, $limit = null) {
        $q = Doctrine_Query::create()
            ->from('ActivityFeed af')
            ->innerJoin('af.ActivityFeedProfiles afu')
            ->andWhere('afu.profile_id = ?', $profileId);
        if ($limit) {
            $q->limit($limit);
        }

        $q->addOrderBy('af.created_at DESC');
        return $q->execute();
    }

    public function findByProfileIdAndType($profileId, $type, $limit = null) {
        $q = Doctrine_Query::create()
            ->from('ActivityFeed af')
            ->innerJoin('af.ActivityFeedProfiles afu')
            ->andWhere('afu.profile_id = ?', $profileId)
            ->andWhere('af.type = ?', $type);
        if ($limit) {
            $q->limit($limit);
        }

        $q->addOrderBy('af.created_at DESC');
        return $q->execute();
    }

}